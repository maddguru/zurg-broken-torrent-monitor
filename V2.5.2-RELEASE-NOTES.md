# Zurg Broken Torrent Monitor v2.5.2 Release Notes

## üéØ Release Highlights

Version 2.5.2 introduces **Health Verification** - a powerful feature that scans your entire library to detect torrents with mismatched status. Combined with persistent settings and memory optimization, this release is built for large libraries.

---

## ‚ú® New Features

### Health Verification System
- **Startup Verification**: Optionally scan all "OK" torrents on startup to confirm their actual status
- **Manual Verification**: Press `V` anytime to run a full health check
- **Mismatch Detection**: Identifies torrents where reported status differs from actual state
- **Progress Display**: Live progress bar with ETA, memory usage, and mismatch count

### Persistent Settings
- **Auto-Save**: Toggle settings (AutoRepair, AutoVerify) are saved to `zurg-monitor-settings.json`
- **Remembers Preferences**: Settings persist between script restarts
- **No More Flags**: No need to pass `-AutoRepair $true` every time

### Memory Optimization
- **ArrayList Usage**: Efficient memory handling for large torrent lists
- **Garbage Collection**: Automatic cleanup after verification and each monitoring cycle
- **Memory Display**: Current memory usage shown in status bar and statistics
- **Mismatch Limit**: Caps stored mismatches at 100 to prevent unbounded growth

---

## üîß Bug Fixes

| Issue | Fix |
|-------|-----|
| False mismatch detection | Corrected HTML parsing for Zurg's actual page structure |
| Script crash on expired timer | Added bounds checking for progress bar calculations |
| Memory output spam | Suppressed raw hashtable output from cleanup function |
| Negative time display | Format-TimeSpan now handles negative/zero values gracefully |

---

## üìä Comparison: v2.4.0 vs v2.5.2

| Feature | v2.4.0 | v2.5.2 |
|---------|--------|--------|
| Health Verification | ‚ùå | ‚úÖ |
| Persistent Settings | ‚ùå | ‚úÖ |
| Memory Optimization | ‚ùå | ‚úÖ |
| Memory Usage Display | ‚ùå | ‚úÖ |
| Mismatch Detection | ‚ùå | ‚úÖ |
| Lines of Code | 1,421 | 2,220 |
| Functions | 14 | 20 |

---

## üñ•Ô∏è New Display Elements

### Wait Screen
```
======================================================================
  WAITING FOR NEXT CHECK                              Mem: 45.23 MB
  Press: [M] Management  [S] Stats  [V] Health Verify  [Ctrl+C] Exit
======================================================================

  [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] Next check in: 22m 15s (at 18:45:30)
```

### Verification Progress
```
  [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 40.2% | 2335/5812 | ETA: 6m 12s | Mismatches: 3 | Mem: 52.18MB
```

### Statistics
```
VERIFICATION:
  Total Verifications Run:   2
  Torrents Verified:         11624
  Mismatches Found:          18
  Mismatches Corrected:      5
  Current Pending Mismatches:13
  Last Verification:         2025-12-11 22:17:10

STATUS:
  AutoRepair:                DISABLED
  AutoVerify:                ENABLED (startup)
  Settings File:             C:\...\zurg-monitor-settings.json
  Memory Usage:              45.23 MB
```

---

## üÜï New Parameters

| Parameter | Default | Description |
|-----------|---------|-------------|
| `-SettingsFile` | `zurg-monitor-settings.json` | Path to settings file |
| `-SkipStartupVerification` | (switch) | Skip verification even if AutoVerify is enabled |
| `-VerifyDelayMs` | `50` | Milliseconds between each torrent check |

---

## üéÆ New Commands

### During Wait Period
| Key | Action |
|-----|--------|
| `V` | Run health verification |

### In Management UI
| Command | Action |
|---------|--------|
| `V` | Run health verification |
| `TV` | Toggle AutoVerify on/off (saves to file) |
| `FM` | Filter to show only Mismatch torrents |

---

## üìÅ Settings File Format

```json
{
  "AutoRepair": false,
  "AutoVerify": true,
  "LastModified": "2025-12-11 19:30:45"
}
```

---

## üí° Usage Examples

```powershell
# Normal run - loads saved settings, runs startup verification if enabled
.\Zurg-Broken-Torrent-Monitor.ps1

# Skip startup verification this time only
.\Zurg-Broken-Torrent-Monitor.ps1 -SkipStartupVerification

# Use custom settings file
.\Zurg-Broken-Torrent-Monitor.ps1 -SettingsFile "my-settings.json"

# Slower verification (less server load)
.\Zurg-Broken-Torrent-Monitor.ps1 -VerifyDelayMs 100
```

---

## ‚¨ÜÔ∏è Upgrade Notes

1. **From v2.4.0**: Simply replace the script file. First run will create settings file with defaults.
2. **Settings Migration**: No migration needed - settings file is created automatically.
3. **Memory**: Large libraries (5000+ torrents) should see improved memory handling.

---

## üîó Links

- **Full Changelog**: [CHANGELOG.md](CHANGELOG.md)
- **Documentation**: [README.md](README.md)
- **Issues**: [GitHub Issues](../../issues)
