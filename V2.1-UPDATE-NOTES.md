# Zurg Broken Torrent Monitor v2.1 - Update Notes

## ğŸ†• What's New in v2.1

### Under Repair Tracking

The script now monitors **both** broken and under repair torrents!

#### New Features:

1. **Detects Under Repair Torrents**
   - Fetches from `/manage/?state=status_under_repair`
   - Shows which torrents are actively being repaired

2. **Re-triggers Repairs**
   - Automatically re-triggers repair for torrents already under repair
   - Helps push stuck repairs forward

3. **Enhanced Comparison**
   - **Successfully Repaired:** Torrents that are now fully fixed
   - **Moved to Repair:** Torrents that went from broken â†’ under repair
   - **Still Broken:** Torrents still in broken state
   - **Still Under Repair:** Torrents still being repaired
   - **New Broken:** New torrents that became broken
   - **Repair Success Rate:** Percentage successfully repaired

4. **Better Statistics**
   - Total broken found
   - Total under repair found
   - Total repairs triggered (includes re-triggers)

## ğŸ“Š Example Output

### Current Check Results
```
CURRENT CHECK RESULTS:
  Broken Torrents:           3
  Under Repair:              5
  Repairs Triggered:         8

  Broken Torrents:
    - Show.Name.S01.1080p
    - Movie.Title.2024
    - Another.Show.S02

  Under Repair:
    - Previously.Broken.S01
    - Repairing.Now.Movie
    - Almost.Done.S03
    - Still.Working.On.This
    - One.More.Torrent
```

### Comparison with Previous Check
```
COMPARISON WITH PREVIOUS CHECK:
  Successfully Repaired:     2    â† Fully fixed! âœ“
  Moved to Repair:           3    â† Progressing! 
  Still Broken:              0    â† Good!
  Still Under Repair:        2    â† Still working
  New Broken:                0    â† No new issues
  Repair Success Rate:       25.0%
```

## ğŸ” How It Works

### What the Script Does Now:

1. **Checks Broken Torrents**
   - Fetches `/manage/?state=status_broken`
   - Lists all broken torrents
   - Triggers repair for each

2. **Checks Under Repair Torrents** (NEW!)
   - Fetches `/manage/?state=status_under_repair`
   - Lists all torrents being repaired
   - Re-triggers repair to help them along

3. **Tracks Progress**
   - Compares with previous check
   - Shows what got fixed
   - Shows what moved from broken â†’ repair
   - Shows what's still being worked on

## ğŸ’¡ Why Re-trigger Under Repair?

Re-triggering repair for torrents already under repair can help:
- Push stuck repairs forward
- Retry downloads from different sources
- Ensure Zurg is actively working on them
- Won't hurt if they're already progressing

## ğŸ¯ Benefits

### Better Visibility
- See exactly what's being repaired
- Track progress between checks
- Identify stuck repairs

### Proactive Maintenance
- Keeps repairs moving forward
- Catches torrents stuck in repair state
- Helps identify chronic problem torrents

### Complete Picture
You now see:
- âŒ **Broken** - Needs repair
- ğŸ”§ **Under Repair** - Being worked on
- âœ… **Fixed** - Successfully repaired

## ğŸ“ˆ Statistics Enhanced

### Overall Statistics Now Show:
```
Total Checks Performed:    10
Total Broken Found:        23
Total Under Repair Found:  15    â† NEW!
Total Repairs Triggered:   38    â† Includes re-triggers
Last Check:                2025-10-31 17:30:00
Last Broken Found:         2025-10-31 17:15:00
```

## ğŸ”„ Comparison Logic Improved

The script now tracks **5 categories** of torrents between checks:

1. **Successfully Repaired** - Was broken/repair, now gone (fixed!)
2. **Moved to Repair** - Was broken, now under repair (progressing!)
3. **Still Broken** - Was broken, still broken (stuck)
4. **Still Under Repair** - Was under repair, still under repair (working on it)
5. **New Broken** - Wasn't in previous check, now broken (new problem)

## ğŸš€ Upgrade from v2.0

Simply replace your old script with the new v2.1 version. No configuration changes needed!

### What Changes:
- âœ… Script now checks both states
- âœ… New comparison categories
- âœ… Enhanced statistics
- âœ… Better visibility into repair progress

### What Stays the Same:
- âœ… All command line parameters
- âœ… Log file format
- âœ… Authentication
- âœ… Check intervals
- âœ… Service/Task Scheduler setup

## ğŸ¨ Color Coding

- ğŸŸ¡ **Yellow** - Broken torrents (needs attention)
- ğŸ”µ **Cyan** - Under repair (being worked on)
- ğŸŸ¢ **Green** - Success messages and good stats
- ğŸ”´ **Red** - New broken torrents (new problems)
- âšª **Gray** - Zero counts (nothing to show)

## ğŸ“ Notes

- Re-triggering repair is safe and won't cause issues
- Under repair torrents are tracked separately from broken
- Success rate calculation includes all torrents (broken + under repair)
- The script still triggers repair for broken torrents first, then under repair

## ğŸ”§ Technical Details

### New Function:
- `Get-ZurgTorrentsByState` - Generalized function to fetch any state
  - Replaces previous `Get-ZurgBrokenTorrents`
  - Can fetch "status_broken" or "status_under_repair"

### Enhanced Stats Tracking:
```powershell
$Script:Stats = @{
    UnderRepairFound = 0              # NEW
    CurrentCheck = @{
        UnderRepairFound = 0          # NEW
        UnderRepairHashes = @()       # NEW
        UnderRepairNames = @()        # NEW
    }
    PreviousCheck = @{
        UnderRepairHashes = @()       # NEW
    }
}
```

## âœ¨ Summary

v2.1 gives you **complete visibility** into your torrent health:
- Know what's broken
- Know what's being repaired  
- Track repair progress
- See success rates
- Identify stuck torrents

All while automatically keeping repairs active! ğŸ‰
